<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inspektionsrapport</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    form { display: grid; gap: 12px; }
    label { font-weight: 600; }
    input, select, button { font-size: 16px; padding: 8px; }
    .hint { color: #555; font-size: 14px; }
    .ok { color: #0a7f2e; }
    .error { color: #b00020; }
  </style>
</head>
<body>
  <h1>Inspektionsrapport</h1>
  <form id="f">
    <div>
      <label for="name">Namn</label><br />
      <input id="name" name="name" required maxlength="100" />
    </div>
    <div>
      <label for="reg">Registreringsnummer</label><br />
      <input id="reg" name="reg" required maxlength="7" pattern="^[A-Za-z0-9]{1,7}$" placeholder="ABC123" />
      <div class="hint">Endast A–Z och 0–9, max 7 tecken.</div>
    </div>
    <div>
      <label for="status">Skick</label><br />
      <select id="status" name="status" required>
        <option value="">Välj…</option>
        <option>Godkänd inspektion. Inga nya skador noterade</option>
        <option>Inspektion behöver granskas</option>
      </select>
    </div>
    <button type="submit">Skicka</button>
  </form>
  <p id="msg"></p>
  <script>
    const FLOW_URL = "https://prod-97.westus.logic.azure.com:443/workflows/a248bd2c1a01408a960434d68b147fa2/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Gfa03ZUPEmaIwzRQT0ArcGKaocNrGLmQNnyD6NIEb8c"; // <-- byt
    const f = document.getElementById("f");
    const msg = document.getElementById("msg");
    const reg = document.getElementById("reg");

    reg.addEventListener("input", () => {
      reg.value = reg.value.toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0,7);
    });

    f.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!f.reportValidity()) return;
      msg.textContent = "";
      try {
        const body = {
          name: document.getElementById("name").value.trim(),
          reg: reg.value.trim().toUpperCase(),
          status: document.getElementById("status").value
        };
        const res = await fetch(FLOW_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json", "X-Public-Token": "pk_example" },
          body: JSON.stringify(body),
          mode: "cors",
          cache: "no-store"
        });
        if (!res.ok) throw new Error(await res.text());
        msg.textContent = "Skickat! Kortet i Teams är uppdaterat.";
        msg.className = "ok";
        f.reset();
      } catch (err) {
        console.error(err);
        msg.textContent = "Kunde inte skicka just nu.";
        msg.className = "error";
      }
    });
  </script>
</body>
</html>
